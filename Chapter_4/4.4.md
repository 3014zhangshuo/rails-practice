# 4.4 模型操作实践

## 概要：

本课时讲解 Rails 中如何通过 Model 中的方法，实现数据库关联，以及如何使用视图中的表单实现关联关系的操作。

## 知识点：

1. 网店设计
2. Nested Form
3. Rspec

## 正文



### 4.4.1 nested_form

accepts_nested_attributes_for

autosave

author_attributes=(attributes)



```
supplier:references{polymorphic}
```


我们创建一个模型，Property，属性。属性保存的是“品牌”，“材质”，“适合性别”。“属性”会被每个商品引用，但是它并不保存每个商品具体的属性是什么。我们把属性值保存在这个中间模型里。

```
rails g model property name 
rails g model product_property value product:references property:references
```

product_property 就是这个充当关联桥梁的模型，它有两个 belongs_to，分别属于关系的两端。

为了让 Product 找到它关联的 Property，我们在 has_many 的基础上，增加 through 参数：

```
class ProductProperty < ActiveRecord::Base
  belongs_to :product
  belongs_to :property
end
```

作为中间表，它的名字是有自己的含义的，在早先的 Rails 版本中（ActiveRecord 之前版本），默认使用的是两边 Model 的单数名称联合的形式，也就是我们例子中的 “ProductProperty”。

我们已经介绍了一对多关系，我们在 Product 中引入这个中间表：

```
class Product < ActiveRecord::Base
  has_many :product_properties
  has_one :property, through: :product_properties
end
```




这段我也没想好

我们创建一个模型，OptionType，它保存的数据有：大小（Size），颜色（Color）。

再创建一个模型，OptionValue，它保存的数据是 S，M，L，Red，White，Yellow。

假设，一个 Product 有多个 OptionValue，但是，每个 OptionValue 属于专属的 OptionType 的：

OptionType | Option Value
-- | --
Size | S
Size | M
Size | L
Color | Red
Color | White
Color | Yellow

这时，OptionType  表充当的是关联的桥梁，也就是中间表。

中间表会我们创建需要的迁移文件：

```
rails g model option_type name position:integer [1]
rails g model product_option_type product:references option_type:references
rails g model option_value position:integer name option_type:references  
rails g migration CreateJoinTableOptionValueVariant option_value variant
```

