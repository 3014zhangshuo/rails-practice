# 第五章 Rails 中的控制器

## 课程概要：

本课程通过对控制器的学习，了解 Rails 如何控制业务逻辑，以及如何保护数据安全。并且完成购物和支付流程。

## 知识点：

1. Request 对象
2. Response 对象
3. Session 对象
4. Rspec 测试

## 课程背景

控制器 Controller 是 MVC 中调度员的角色，由它控制着流程的


# 5.1 控制器中的方法

## 概要

本课时讲解控制器中如何处理传入的参数和相应，以及如何使用回调，和 etag 缓存。

## 知识点

* params
* session
* cookies
* 回调
* etag

## 正文


### 5.1.1 strong paramaters

attr_accessible :name 白名单

https://github.com/rails/protected_attributes


### 5.1.2 session 和 cookies


### 5.1.3 回调

before_action

### 5.1.4 etag

### 5.1.5 respond_to 方法

### 5.1.6 csrf

在我们的布局（layout）页面，你可能已经看到这样一个辅助方法：

```
<%= csrf_meta_tags %>
```

打开页面的源码，我们可以看到：

```
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="O3Li25wJK0buXKRQRX4CzpAWheQIQ4VknCPe3KwNIFkIuUsbBApxl2jVVTd9IcmzR8oHLZI0qZpO39aLdNaBAQ==" />
```

当我使用表单的辅助方法 `form_for` 和 `form_tag` 时，表单会自动创建一个隐藏控件

```
<input type="hidden" name="authenticity_token" value="GI5YwKDhQA4pMlLRaUlpHugYdL5ygNe3Co6TL8PvZDsrRfEAOOIa36+7o7ZRFqJjP8T2d+j3+0nYcpt4GzTFYw==">
```

当我们使用 `remote: true` 时，这个控件又消失了，这样是不是不安全？不，ujs 在提交的时候，为我们自动补充上了 `authenticity_token` 参数

[http://guides.ruby-china.org/security.html](http://guides.ruby-china.org/security.html)





