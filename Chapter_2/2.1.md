# 第二章 scaffold 命令

## 课程概要：

本课程通过 scaffold 命令，创建一个资源（product），讲解资源文件含义，并详解 Rails 如何实现 REST。

## 知识点：

1. scaffold 命令
2. 文件详解
3. REST
4. routes

## 课程背景

REST（Representational State Transfer），具有代表性的状态传递，是一种轻量级的 Web Service 架构风格。通过对 REST 的学习，了解 Rails 如何处理和相应 web 请求。

# 2.1 用 scaffold 创建资源

## 概要：

本课时详细介绍 scaffold 命令创建的资源文件。

## 知识点：

1. scaffold
2. scss
3. coffeescript
4. erb
5. minitest
6. rspec

## 正文

### 2.1.1 scaffold

上一节，我们用 `new` 创建了一个 Rails 项目，现在，我们进入它的目录中，再运行一个命令：

```
rails g scaffold product name description 'price:decimal{8,2}'
```

scaffold 的中文称呼是 “脚手架”，个人觉得它不是很形象，如果称它为“一大堆 generator（生成器） 的集合”，似乎形象很多。Rails 为我们提供了一些 generator，用来创建各种文件。scaffold 将这些 generator 一次运行了。

我们先看下 rails 给了我们哪命令：

```
% rails -h
generate    用它来创建代码 (简写 "g")
console     运行调试控制台 (简写 "c")
server      运行 Rails 服务 (简写 "s")
dbconsole   运行数据库调试控制台 (简写 "db")
new         创建新的 Rails 项目。 你也可以 "rails new ." 它会在当前目录下创建
destroy     删除 "generate" 创建的文件 (简写 "d")
```

举个栗子。我们创建一个 Model 文件，这样写：

```
rails g model product
```

使用 scaffold 时，我们写的每一个部分为：

```
rails g scaffold [资源名] [属性列表] [参数]
```

那么刚才的命令，我们创建了这些文件：

```
invoke  active_record
create    db/migrate/20150216160325_create_products.rb
create    app/models/product.rb
invoke    test_unit
create      test/models/product_test.rb
create      test/fixtures/products.yml
invoke  resource_route
route    resources :products
invoke  scaffold_controller
create    app/controllers/products_controller.rb
invoke    erb
create      app/views/products
create      app/views/products/index.html.erb
create      app/views/products/edit.html.erb
create      app/views/products/show.html.erb
create      app/views/products/new.html.erb
create      app/views/products/_form.html.erb
invoke    test_unit
create      test/controllers/products_controller_test.rb
invoke    helper
create      app/helpers/products_helper.rb
invoke      test_unit
invoke    jbuilder
create      app/views/products/index.json.jbuilder
create      app/views/products/show.json.jbuilder
invoke  assets
invoke    coffee
create      app/assets/javascripts/products.coffee
invoke    scss
create      app/assets/stylesheets/products.scss
invoke  scss
identical    app/assets/stylesheets/scaffolds.scss
```

如何理解这些文件的用途？我想先介绍一下“资源”这个概念。scaffold 创建了一个 product 的资源。它在系统里是复数存在的，只有在 model 中，它是单数。

```
route    resources :products
```

打开 `config/routes.rb` 可以看到定义的资源。其实，常见的 URL 中的 R 就是这个资源， Rails 也是从管理资源开始的。

scaffold 还为我们创建了 MVC 所用的文件，这在我们下一章开始介绍。简单的介绍下，M 就是 `app/models/product.rb`，V 就是 `app/views/products` 中的文件，C 就是 `app/controllers/products_controller.rb`。


其实，我们是可以配置 scaffold，不要为我们创建这么多代码的，但是在我们学习阶段，可以不这么做。配置写在 `config/application.rb` 中：

```
class Application < Rails::Application

  ...
  config.generators do |cfg|
    cfg.stylesheets     false
    cfg.javascripts     false
    cfg.helpers         false
  end
```

这样，我们scaffold 就不再创建 helper，css，js 文件了。

### 2.1.2 测试

除了上面介绍的，scaffold 还为我们添加了测试文件 `test/models/product_test.rb` 和 `test/controllers/products_controller_test.rb`。

这里，Rails 默认使用的是 minitest，更多介绍可以看[这里](http://docs.seattlerb.org/minitest/)。当然，我们页可以使用 Rspec。

我们可以修改 Gemfile

```
group :development, :test do
  gem 'rspec-rails'
end
```

运行这个命令，创建 rspec 文件，它也是一个 generator：

```
% rails generate rspec:install
create  .rspec
create  spec
create  spec/spec_helper.rb
create  spec/rails_helper.rb
```

我们补上 Model 和 Controller 的测试文件：

```
rails generate rspec:model product
rails generate rspec:controller products
```

我们在 Rails 项目文件夹中运行这个命令：

```
% rspec
**

Pending: (Failures listed here are expected and do not affect your suite's status)

  1) ProductsController 
     # Not yet implemented
     # ./spec/controllers/products_controller_spec.rb:4

  2) Product add some examples to (or delete) /Users/liwei/Desktop/Rails_practice_p1_0/code/chapter_2/shop/spec/models/product_spec.rb
     # Not yet implemented
     # ./spec/models/product_spec.rb:4


Finished in 0.00058 seconds (files took 1.6 seconds to load)
```

我们看到测试文件已经可以运行了，虽然我们还未给它写一行测试用例（Test Case）。

在后面 MVC 开发的部分，我们会继续添加它的代码。Rspec 的代码和文档在这里：

[https://github.com/rspec/rspec](https://github.com/rspec/rspec)

[https://github.com/rspec/rspec-rails](https://github.com/rspec/rspec-rails)

### 2.1.3 scss

### 2.1.4 coffeescript

### 2.1.5 erb
